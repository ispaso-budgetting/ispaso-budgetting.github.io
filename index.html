<!DOCTYPE html>
<head>
    <title>Principia Budgeting Tool | ISPASO</title>
    <link rel='stylesheet' href='income_form.css'></link>
    <script src="vue3.global.js"></script>
</head>

<body>
    <div id='app'>
      <h1>Prinbill Budgeting Tool</h1>
      <p>By ISPASO</p>

      <form @submit.prevent='save(1)'>
        <fieldset>
          <legend>Hi. Nice to meet you</legend>
          <p>What academic period are you budgeting for?</p>
          <label>Start</label>
          <label v-for = 'period in budgetPeriods'>
            <input type='radio' :value='period.id' v-model='budgetPeriod' name='budgetPeriod' />
            {{ period.name }}
            <!-- :disabled='budgetPeriod.includes(period.excludes)' -->
          </label>
        </fieldset>

        <fieldset>
          <legend>Income</legend>
          <label>Financial Aid: <input type = 'number' v-model='finAid' placeholder = '$xx,xxx.xx' /></label>

          <h6>Student Employment</h6>
          <label>Hourly wage
            <input type='number' placeholder='12.5' v-model='hourlyWage' />
          </label>

          <label>Projected Weekly Hours
            <input type='number' placeholder='20' max=20  v-model='sessionHours'/>
          </label>

          <h6>Other Income Sources</h6>
          <label v-for='(extra, i) in extraIncome' :key='i'>
            <input type='text' placeholder='Short description' v-model='extra.name' />
            <input type='number' placeholder='$x,xxx' v-model='extra.amount' />
            <input type='date' v-model='extra.date' />
            <button type='button' @click='extraIncome.splice(i, 1)'>Delete</button>
          </label>

          <button type='button' @click='addExtraIncome'>Add Extra Income</button>

          <p><button type='button' @click='showAdvancedIncome = !showAdvancedIncome'><span v-if='showAdvancedIncome'>Hide</span><span v-else>Show</span> Advanced</button></p>

          <fieldset v-if='showAdvancedIncome'>
            <legend>Advanced</legend>
            <label>Income Tax: <input type='number' v-model='incomeTax' /></label>
          </fieldset>
        </fieldset>

        <fieldset>
          <legend>Expenditure</legend>
          </p>For now, we're going to focus on your PrinBill. You can add other expenditures later. This section is to calculate your PrinBill</p>

          <h6>Tax</h6>
          <label>
            Have you been in the US for at least 5 years?

            <label><input type='radio' value=1 v-model='isResident' />Yes</label>
            <label><input type='radio' value=0 v-model='isResident' />No</label>
          </label>

          <div v-if='isResident == 0'>
            <label>Country of Citizenship</label>
            <select v-model='cocz'>
              <option v-for='country in countries' :value='country.code'>{{ country.name }}</option>
            </select>
          </div>

          <h6>Insurance</h6>
          <label>Did you waive your insurance?</label>
          <label><input type='radio' value=1 v-model='waivedInsurance' />Yes</label>
          <label><input type='radio' value=0 v-model='waivedInsurance' />No</label>

          <!--
            <h6>Age</h6>
            <label v-if='!noDOB'>Date of Birth
            <input type='date' :max='maxDOB' v-model='birthdate'>
            </label>
            <label>I don't want to enter my date of birth <input type='checkbox' v-model='noDOB' /></label>

            <div v-if='noDOB'>
            <p>Choose the bracket you fall in.</p>
            <label><input type='radio' value='a' v-model='ageBracket' name='ageBracket' /> Under 25</label>
            <label><input type='radio' value='b' v-model='ageBracket' name='ageBracket' /> 25 - 29</label>
            <label><input type='radio' value='c' v-model='ageBracket' name='ageBracket' /> 30+</label>
            </div>
          -->

          <h6>Other Expenses</h6>
          <h6>Break Housing</h6>
          <label>How many days are you staying in break housing
            <input type='number' />
          </label>

          <h6>Course Fees</h6>
          <p>Do you have any courses that have fees attached?</p>
          <input type='number' placeholder='$XXX' />

          <h6>Extra expenses</h6>
          <p>Enter any extra expenses</p>
          <label v-for='(extra, i) in extraExpenditure' :key='i'>
            <input type='text' placeholder='Short description' v-model='extra.name' />
            <input type='number' placeholder='$x,xxx' v-model='extra.amount' />
            <input type='date' v-model='extra.date' />
            <button type='button' @click='extraExpenditure.splice(i, 1)'>Delete</button>
          </label>

          <button type='button' @click='addExtraExpenditure'>Add Extra Expense</button>

          <button>Save</button>

          <a href='./results' target='_blank'>View Results</a>
        </fieldset>
      </form>
    </div>

    <script type='module'>
        import countries from './utils/countries.js';
        import store from './store/index.js';
        import { budgetPeriods } from './budget/index.js';

        const app = Vue.createApp({
            data() {
                return {
                    budgetPeriods,
                    budgetPeriod: null,

                    gradYears: [],
                    gradMonth: null,
                    gradYear: null,

                    // INCOME
                    finAid: null,
                    hourlyWage: null,
                    sessionHours: null,
                    breakHours: null,
                    extraIncome: null,
                    extraExpenditure: null,

                    // EXPENDITURE
                    incomeTax: null,
                    showAdvancedIncome: false,
                    waivedInsurance: null,
                    isResident: null,
                    cocz: null,
                    countries: countries,
                    birthdate: null,
                    ageBracket: null,
                    noDOB: false,
                    maxDOB: null
                }
            },

            methods: {
                addExtraIncome() {
                    var today = new Date().toISOString().slice(0, 10);

                    this.extraIncome.push({
                        name: null, date: today, amount: null
                    });
                },
                addExtraExpenditure() {
                    var today = new Date().toISOString().slice(0, 10);

                    this.extraExpenditure.push({
                        name: null, date: today, amount: null
                    });
                },
                save(level) {
                  const {
                    gradDate, finAid, ageBracket,
                    sessionHours, breakHours, 
                    budgetPeriod, hourlyWage, incomeTax,
                    birthdate, extraExpenditure, extraIncome
                  } = this;

                  store.save({
                    birthdate,
                    extraIncome, extraExpenditure,
                    gradDate, finAid, ageBracket,
                    sessionHoursPerWeek: sessionHours,
                    budgetPeriod, hourlyWage, incomeTax,
                  });

                    if(this.noDOB)
                        store.save('birthdate', null);

                    return false;
                }
            },

            mounted() {
                this.budgetPeriod = store.get('budgetPeriod');
                this.finAid = store.get("finAid");
                this.extraIncome = store.get("extraIncome");
                this.extraExpenditure = store.get("extraExpenditure");
                this.hourlyWage = store.get("hourlyWage");
                this.ageBracket = store.get("ageBracket");
                this.birthdate = store.get("birthdate");
                if(!this.birthdate && this.ageBracket)
                    this.noDOB = true;

                this.sessionHours = store.get("sessionHoursPerWeek");
                this.incomeTax = store.get("incomeTax");
            }
        });

        app.use(store);
        app.mount('#app');
    </script>
</body>
</html>

